!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).AnimatorClip={})}(this,(function(t){"use strict";var e=Object.defineProperty,n=(t,n,i)=>((t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i)(t,"symbol"!=typeof n?n+"":n,i);const i="_dap-datas",s={remove(t,e){const n=t[i]||{};e?(delete n[e],t[i]=n):t[i]={}},has:(t,e)=>(t[i]||{}).hasOwnProperty(e),get(t,e){const n=t[i]||{};return e?n[e]:n},set(t,e,n){const s=t[i]||{};s[e]=n,t[i]=s}},o={insert(t,e,n){if(n<0)throw new Error("The third argument cannot be less than 0");return t.substring(0,n)+e+t.substring(n,t.length)},delete(t,e,n){if(e<0)throw new Error("The second argument cannot be less than 0");if(n<0)throw new Error("The third argument cannot be less than 0");return t.substring(0,e)+t.substring(e+n,t.length)},replace(t,e,n,i){if(e<0)throw new Error("The second argument cannot be less than 0");if(n<0)throw new Error("The third argument cannot be less than 0");return t.substring(0,e)+i+t.substring(n,t.length)},trim(t,e){let n=t.replace(/(^\s+)|(\s+$)/g,"");return e&&(n=n.replace(/\s/g,"")),n}},r={formatNumber(t){return this.isNumber(t)?t.toString().replace(/(\d)(?=(?:\d{3})+$)/g,"$1,"):t.toString()},isNumber:t=>"number"==typeof t&&!isNaN(t),add:(...t)=>t.reduce(((t,e)=>{let n=0,i=0,s=0;try{n=t.toString().split(".")[1].length}catch(o){}try{i=e.toString().split(".")[1].length}catch(o){}return s=Math.pow(10,Math.max(n,i)),(t*s+e*s)/s})),subtract:(...t)=>t.reduce(((t,e)=>{let n=0,i=0,s=0;try{n=t.toString().split(".")[1].length}catch(o){}try{i=e.toString().split(".")[1].length}catch(o){}return s=Math.pow(10,Math.max(n,i)),(t*s-e*s)/s})),mutiply:(...t)=>t.reduce(((t,e)=>{let n=0,i=t.toString(),s=e.toString();try{n+=i.split(".")[1].length}catch(o){}try{n+=s.split(".")[1].length}catch(o){}return Number(i.replace(".",""))*Number(s.replace(".",""))/Math.pow(10,n)})),divide:(...t)=>t.reduce(((t,e)=>{let n=0,i=0,s=t.toString(),o=e.toString();try{n=s.split(".")[1].length}catch(r){}try{i=o.split(".")[1].length}catch(r){}return Number(s.replace(".",""))/Number(o.replace(".",""))*Math.pow(10,i-n)}))},l={isWindow:t=>t&&t instanceof Window,getElementPoint(t,e){if(this.isElement(e)||(e=document.body),!this.isContains(e,t))throw new Error("The second argument and the first argument have no hierarchical relationship");const n=t;let i=0,s=0;for(;this.isElement(t)&&this.isContains(e,t)&&e!==t;)i+=t.offsetTop,s+=t.offsetLeft,t=t.offsetParent;return{top:i,left:s,right:e.offsetWidth-s-n.offsetWidth,bottom:e.offsetHeight-i-n.offsetHeight}},isContains:(t,e)=>t===e||(t.contains?t.contains(e):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(e))),isParentNode:(t,e)=>t!==e&&e.parentNode===t,children(t,e){const n=Array.from(t.querySelectorAll(e??"*"));return Array.from(n).filter((e=>this.isParentNode(t,e)))},siblings(t,e){if(!t.parentNode)return[];return Array.from(t.parentNode.querySelectorAll(e??"*")).filter((e=>e.parentNode===t.parentNode&&e!=t))},rem2px(t){const e=this.getCssStyle(document.documentElement,"font-size");return r.mutiply(t,parseFloat(e))},px2rem(t){const e=this.getCssStyle(document.documentElement,"font-size");return r.divide(t,parseFloat(e))},width(t){"string"==typeof t&&t&&(t=document.body.querySelector(t)),this.isElement(t)||(t=document.body);const e=t.clientWidth,n=parseFloat(this.getCssStyle(t,"padding-left")),i=parseFloat(this.getCssStyle(t,"padding-right"));return r.subtract(e,n,i)},height(t){"string"==typeof t&&t&&(t=document.body.querySelector(t)),this.isElement(t)||(t=document.body);const e=t.clientHeight,n=parseFloat(this.getCssStyle(t,"padding-top")),i=parseFloat(this.getCssStyle(t,"padding-bottom"));return r.subtract(e,n,i)},removeClass(t,e){o.trim(e).split(/\s+/).forEach((e=>{t.classList.remove(e)}))},addClass(t,e){o.trim(e).split(/\s+/).forEach((e=>{t.classList.add(e)}))},hasClass:(t,e)=>o.trim(e).split(/\s+/).every((e=>t.classList.contains(e))),scrollTopBottomTrigger(t,e){"string"==typeof t&&t&&(t=document.body.querySelector(t));let n=window;this.isElement(t)&&t!=document.body&&t!=document.documentElement&&(n=t),"function"==typeof t&&(e=t);let i=!0;n.addEventListener("scroll",(()=>{if(this.getScrollTop(n)<=0){if(!i)return;"function"==typeof e&&(i=!1,e({state:"top",target:n}))}else{const t={state:"bottom",target:n};let s=0;if(s=n==window?window.innerHeight:n.clientHeight,r.add(this.getScrollTop(n),s)+1>=this.getScrollHeight(n)&&s!=this.getScrollHeight(n)){if(!i)return;"function"==typeof e&&(i=!1,e(t))}else i=!0}}))},getScrollWidth(t){"string"==typeof t&&t&&(t=document.body.querySelector(t));let e=0;return e=this.isElement(t)&&t!=document.documentElement&&t!=document.body?t.scrollWidth:0==document.documentElement.scrollWidth||0==document.body.scrollWidth?document.documentElement.scrollWidth||document.body.scrollWidth:document.documentElement.scrollWidth>document.body.scrollWidth?document.documentElement.scrollWidth:document.body.scrollWidth,e},getScrollHeight(t){"string"==typeof t&&t&&(t=document.body.querySelector(t));let e=0;return e=this.isElement(t)&&t!=document.documentElement&&t!=document.body?t.scrollHeight:0==document.documentElement.scrollHeight||0==document.body.scrollHeight?document.documentElement.scrollHeight||document.body.scrollHeight:document.documentElement.scrollHeight>document.body.scrollHeight?document.documentElement.scrollHeight:document.body.scrollHeight,e},setScrollTop(t){let e=!1,n=t.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));const i=t.number||0,s=t.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(e=!0),new Promise((t=>{if(s<=0)e?document.documentElement.scrollTop=document.body.scrollTop=i:n.scrollTop=i,t();else{const o=10;let l=r.divide(s,o),h=this.getScrollTop(n);const a=r.divide(r.subtract(i,h),l),d=setInterval((()=>{l>0?(l--,e?document.documentElement.scrollTop=document.body.scrollTop=h=r.add(h,a):n.scrollTop=h=r.add(h,a)):(clearInterval(d),t())}),o)}}))},getScrollTop(t){"string"==typeof t&&t&&(t=document.body.querySelector(t));let e=0;return e=this.isElement(t)&&t!=document.body&&t!=document.documentElement&&t!=window?t.scrollTop:0==document.documentElement.scrollTop||0==document.body.scrollTop?document.documentElement.scrollTop||document.body.scrollTop:document.documentElement.scrollTop>document.body.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,e},getScrollLeft(t){"string"==typeof t&&t&&(t=document.body.querySelector(t));let e=0;return e=this.isElement(t)&&t!=document.body&&t!=document.documentElement&&t!=window?t.scrollLeft:0==document.documentElement.scrollLeft||0==document.body.scrollLeft?document.documentElement.scrollLeft||document.body.scrollLeft:document.documentElement.scrollLeft>document.body.scrollLeft?document.documentElement.scrollLeft:document.body.scrollLeft,e},setScrollLeft(t){let e=!1,n=t.el;"string"==typeof n&&n&&(n=document.body.querySelector(n));const i=t.number||0,s=t.time||0;return this.isElement(n)&&n!=document.body&&n!=document.documentElement&&n!=window||(e=!0),new Promise((t=>{if(s<=0)e?document.documentElement.scrollLeft=document.body.scrollLeft=i:n.scrollLeft=i,t();else{const o=10;let l=r.divide(s,o),h=this.getScrollLeft(n);const a=r.divide(r.subtract(i,h),l);let d=setInterval((()=>{l>0?(l--,e?document.documentElement.scrollLeft=document.body.scrollLeft=h=r.add(h,a):n.scrollLeft=h=r.add(h,a)):(clearInterval(d),t())}),o)}}))},getCssStyle(t,e){let n="";return n=document.defaultView&&document.defaultView.getComputedStyle?document.defaultView.getComputedStyle(t)[e]:t.currentStyle[e],n},getCssSelector(t){if(/^#{1}/.test(t))return{type:"id",value:t.substring(1)};if(/^\./.test(t))return{type:"class",value:t.substring(1)};if(/^\[(.+)\]$/.test(t)){let e="";const n=o.trim(t,!0).substring(1,o.trim(t,!0).length-1).split("=");return 1==n.length&&(e=n[0]),2==n.length&&(e={attributeName:n[0],attributeValue:n[1].replace(/\'/g,"").replace(/\"/g,"")}),{type:"attribute",value:e}}return{type:"tag",value:t}},getElementBounding(t){"string"==typeof t&&t&&(t=document.body.querySelector(t)),this.isElement(t)||(t=document.body);const e=t.getBoundingClientRect();return{top:e.top,bottom:r.subtract(document.documentElement.clientHeight||window.innerHeight,e.bottom),left:e.left,right:r.subtract(document.documentElement.clientWidth||window.innerWidth,e.right)}},isElement:t=>!!t&&t instanceof Node&&1===t.nodeType,string2dom(t){const e=document.createElement("template");return e.innerHTML=t,1==e.content.children.length?e.content.children[0]:Array.from(e.content.children)}};t.Animator=class{constructor(t,e){n(this,"$el"),n(this,"onStart"),n(this,"onStop"),n(this,"onReset"),n(this,"onBeforeUpdate"),n(this,"onUpdate"),n(this,"onComplete"),n(this,"children",[]),this.$el="string"==typeof t&&t?document.body.querySelector(t):t,(null==e?void 0:e.onStart)&&(this.onStart=e.onStart),(null==e?void 0:e.onStop)&&(this.onStop=e.onStop),(null==e?void 0:e.onReset)&&(this.onReset=e.onReset),(null==e?void 0:e.onBeforeUpdate)&&(this.onBeforeUpdate=e.onBeforeUpdate),(null==e?void 0:e.onUpdate)&&(this.onUpdate=e.onUpdate),(null==e?void 0:e.onComplete)&&(this.onComplete=e.onComplete)}hasClip(t){return!!t.parent&&(!!this.children.length&&this.children.some((e=>e.key===t.key)))}addClip(t){if(!this.hasClip(t)&&t.parent)throw new Error("The clip has been added to other animator");if(this.hasClip(t))throw new Error("The clip has been added to the animator");return t.parent=this,t.free||(t.unit?t.initValue=t.getUnitCssValue()+t.unit:t.initValue=t.getUnitCssValue()),this.children.push(t),this}removeClip(t){if(!t.parent)throw new Error("The clip has not been added to the animator");if(!this.hasClip(t))throw new Error("The clip does not belong to the animator");const e=this.children.findIndex((e=>e.key==t.key));return this.children=this.children.splice(e,1),t.state=0,t.timeStamp=0,t.interval=0,t.free||(t.parent.$el.style.setProperty(t.style,t.initValue+"","important"),t.initValue=void 0),t.parent=void 0,this}removeAllClips(){for(;0<this.children.length;){const t=this.children[0];this.removeClip(t)}return this}getClips(){return this.children.filter((t=>1==t.state))}getStopClips(){return this.children.filter((t=>2==t.state))}getCompleteClips(){return this.children.filter((t=>3==t.state))}start(){return this.children.forEach((t=>{t.start()})),this}stop(){return this.children.forEach((t=>{t.stop()})),this}reset(t=!0){return this.children.forEach((e=>{e.reset(t)})),this}},t.Clip=class{constructor(t){n(this,"style"),n(this,"value"),n(this,"speed"),n(this,"free",!1),n(this,"onStart"),n(this,"onStop"),n(this,"onReset"),n(this,"onBeforeUpdate"),n(this,"onUpdate"),n(this,"onComplete"),n(this,"key",(()=>{let t=s.get(window,"animator-clip-key")||0;return t++,s.set(window,"animator-clip-key",t),t})()),n(this,"type",0),n(this,"interval",0),n(this,"unit"),n(this,"requestAnimationFrame"),n(this,"state",0),n(this,"chainClip"),n(this,"initValue"),n(this,"parent"),n(this,"timeStamp",0),this.free=t.free??!1,this.free||(this.style=t.style,this.speed=t.speed,this.value="number"==typeof t.value?t.value:parseFloat(t.value),this.unit=this.getUnit(t.value)),t.onStart&&(this.onStart=t.onStart),t.onStop&&(this.onStop=t.onStop),t.onReset&&(this.onReset=t.onReset),t.onBeforeUpdate&&(this.onBeforeUpdate=t.onBeforeUpdate),t.onUpdate&&(this.onUpdate=t.onUpdate),t.onComplete&&(this.onComplete=t.onComplete),this.requestAnimationFrame=this.getRequestAnimationFrame()}start(){var t,e;if(!this.parent||!this.parent.$el)throw new Error("The clip has not been added to the animator");if(!this.free){const t=this.getUnitCssValue();if(this.speed>0&&t>=this.value)return this;if(this.speed<0&&t<=this.value)return this}if(1==this.state||3==this.state)return this;this.timeStamp=Date.now(),this.interval=0,this.state=1,null==(t=this.parent.onStart)||t.apply(this.parent,[this,this.parent.$el]),null==(e=this.onStart)||e.apply(this,[this.parent.$el]);const n=()=>{var t,e,i,s,o,r,l,h,a,d;if(1!=this.state)return 1;const p=Date.now();if(this.interval=p-this.timeStamp,this.timeStamp=p,this.free)null==(t=this.parent.onBeforeUpdate)||t.apply(this.parent,[this,this.parent.$el]),null==(e=this.onBeforeUpdate)||e.apply(this,[this.parent.$el]),null==(i=this.parent.onUpdate)||i.apply(this.parent,[this,this.parent.$el]),null==(s=this.onUpdate)||s.apply(this,[this.parent.$el]),this.requestAnimationFrame.apply(window,[n]);else{const t=this.getUnitCssValue();null==(o=this.parent.onBeforeUpdate)||o.apply(this.parent,[this,this.parent.$el,this.style,t]),null==(r=this.onBeforeUpdate)||r.apply(this,[this.parent.$el,this.style,t]);const e=t+this.speed;this.unit?this.parent.$el.style.setProperty(this.style,e+this.unit,"important"):this.parent.$el.style.setProperty(this.style,e+"","important"),null==(l=this.parent.onUpdate)||l.apply(this.parent,[this,this.parent.$el,this.style,e]),null==(h=this.onUpdate)||h.apply(this,[this.parent.$el,this.style,e]),this.speed>0&&e>=this.value||this.speed<0&&e<=this.value?(this.unit?this.parent.$el.style.setProperty(this.style,this.value+this.unit,"important"):this.parent.$el.style.setProperty(this.style,this.value+"","important"),this.timeStamp=0,this.interval=0,this.state=3,null==(a=this.parent.onComplete)||a.apply(this.parent,[this,this.parent.$el]),null==(d=this.onComplete)||d.apply(this,[this.parent.$el]),this.chainClip&&(this.parent.hasClip(this.chainClip)?this.parent.removeClip(this.chainClip).addClip(this.chainClip):this.parent.addClip(this.chainClip),this.chainClip.start())):this.requestAnimationFrame.apply(window,[n])}return 1};return this.requestAnimationFrame.apply(window,[n]),this}stop(){var t,e;if(!this.parent||!this.parent.$el)throw new Error("The clip has not been added to the animator");return 1!=this.state||(this.timeStamp=0,this.interval=0,this.state=2,null==(t=this.parent.onStop)||t.apply(this.parent,[this,this.parent.$el]),null==(e=this.onStop)||e.apply(this,[this.parent.$el])),this}reset(t=!0){var e,n;if(!this.parent||!this.parent.$el)throw new Error("The clip has not been added to the animator");return 0==this.state||(this.timeStamp=0,this.interval=0,this.state=0,!this.free&&t&&this.parent.$el.style.setProperty(this.style,this.initValue+"","important"),null==(e=this.parent.onReset)||e.apply(this.parent,[this,this.parent.$el]),null==(n=this.onReset)||n.apply(this,[this.parent.$el]),1==this.type&&this.parent.removeClip(this)),this}chain(t){if(t.parent)throw new Error("The clip has been added to an animator instance and cannot be passed as a chain argument");return t.type=1,this.chainClip=t,t}emitComplete(){var t,e;if(!this.parent||!this.parent.$el)throw new Error("The clip has not been added to the animator");this.free&&0!=this.state&&3!=this.state&&(this.state=3,null==(t=this.parent.onComplete)||t.apply(this.parent,[this,this.parent.$el]),null==(e=this.onComplete)||e.apply(this,[this.parent.$el]),this.chainClip&&(this.parent.hasClip(this.chainClip)?this.parent.removeClip(this.chainClip).addClip(this.chainClip):this.parent.addClip(this.chainClip),this.chainClip.start()))}getUnitCssValue(){const t=parseFloat(l.getCssStyle(this.parent.$el,this.style));return"rem"==this.unit?l.px2rem(t):"em"==this.unit?this.px2em(this.parent.$el,t):t}getRequestAnimationFrame(){if(window.requestAnimationFrame)return window.requestAnimationFrame;let t=0;return function(e){let n=Date.now(),i=Math.max(0,1e3/60-(n-t));return window.setTimeout(e,i),t=n+i,1}}getUnit(t){if("number"!=typeof t)return t.endsWith("px")?"px":t.endsWith("rem")?"rem":t.endsWith("em")?"em":void 0}px2em(t,e){const n=t.parentNode||t.parentElement,i=l.getCssStyle(n,"font-size");return e/parseFloat(i)}},Object.defineProperty(t,Symbol.toStringTag,{value:"Module"})}));
